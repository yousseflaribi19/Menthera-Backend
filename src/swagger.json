{
  "openapi": "3.0.3",
  "info": {
    "title": "Menthera API",
    "version": "1.0.0",
    "description": "API backend for Psychologue Virtuel â€” user auth, voice sessions, billing, notifications, weekly summaries, challenges and ratings."
  },
  "servers": [
    { "url": "http://localhost:5000/api/v1", "description": "Local development" }
  ],
  "components": {
    "securitySchemes": {
      "bearerAuth": { "type": "http", "scheme": "bearer", "bearerFormat": "JWT" }
    },
    "schemas": {
      "User": {
        "type": "object",
        "properties": {
          "_id": { "type": "string" },
          "email": { "type": "string" },
          "name": { "type": "string" },
          "isPremium": { "type": "boolean" }
        }
      },
      "Subscription": {
        "type": "object",
        "properties": {
          "tier": { "type": "string" },
          "startsAt": { "type": "string", "format": "date-time" },
          "expiresAt": { "type": "string", "format": "date-time" },
          "isActive": { "type": "boolean" }
        }
      },
      "Notification": {
        "type": "object",
        "properties": {
          "_id": { "type": "string" },
          "type": { "type": "string" },
          "title": { "type": "string" },
          "body": { "type": "string" },
          "read": { "type": "boolean" },
          "channel": { "type": "string" }
        }
      },
      "AdviceRating": {
        "type": "object",
        "properties": {
          "_id": { "type": "string" },
          "user": { "type": "string" },
          "session": { "type": "string" },
          "rating": { "type": "integer", "minimum": 1, "maximum": 5 },
          "comment": { "type": "string" }
        }
      },
      "WeeklyChallenge": {
        "type": "object",
        "properties": {
          "_id": { "type": "string" },
          "title": { "type": "string" },
          "weekStart": { "type": "string", "format": "date" }
        }
      }
    }
  },
  "security": [{ "bearerAuth": [] }],
  "paths": {
    "/auth/register": {
      "post": {
        "summary": "Register a new user",
        "tags": ["Auth"],
        "requestBody": {
          "required": true,
          "content": { "application/json": { "schema": { "type": "object", "properties": { "email": { "type": "string" }, "password": { "type": "string" }, "name": { "type": "string" } }, "required": ["email","password"] } } }
        },
        "responses": { "201": { "description": "User created" }, "400": { "description": "Validation error" } }
      }
    },
    "/auth/login": {
      "post": {
        "summary": "Authenticate and receive JWT",
        "tags": ["Auth"],
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "type": "object", "properties": { "email": { "type": "string" }, "password": { "type": "string" } }, "required": ["email","password"] } } } },
        "responses": { "200": { "description": "OK - returns token" }, "401": { "description": "Unauthorized" } }
      }
    },
    "/voice/process": {
      "post": {
        "summary": "Upload voice file and process a session",
        "tags": ["Voice"],
        "security": [{ "bearerAuth": [] }],
        "requestBody": { "content": { "multipart/form-data": { "schema": { "type": "object", "properties": { "file": { "type": "string", "format": "binary" }, "prompt": { "type": "string" } } } } } },
        "responses": { "200": { "description": "Session processed" }, "429": { "description": "Rate limit / premium block" } }
      }
    },
    "/billing/webhook": {
      "post": {
        "summary": "Stripe webhook endpoint",
        "tags": ["Billing"],
        "requestBody": { "content": { "application/json": { "schema": { "type": "object" } } } },
        "responses": { "200": { "description": "Received" } }
      }
    },
    "/notifications": {
      "get": {
        "summary": "List notifications for current user",
        "tags": ["Notifications"],
        "security": [{ "bearerAuth": [] }],
        "parameters": [{ "name": "page", "in": "query", "schema": { "type": "integer" } }],
        "responses": { "200": { "description": "List of notifications", "content": { "application/json": { "schema": { "type": "object" } } } } }
      }
    },
    "/notifications/unread-count": {
      "get": {
        "summary": "Get unread notifications count",
        "tags": ["Notifications"],
        "security": [{ "bearerAuth": [] }],
        "responses": { "200": { "description": "{ count: number }" } }
      }
    },
    "/sessions/{sessionId}/rate": {
      "post": {
        "summary": "Rate a session (AdviceRating)",
        "tags": ["Ratings"],
        "security": [{ "bearerAuth": [] }],
        "parameters": [{ "name": "sessionId", "in": "path", "required": true, "schema": { "type": "string" } }],
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "type": "object", "properties": { "rating": { "type": "integer" }, "comment": { "type": "string" } }, "required": ["rating"] } } } },
        "responses": { "201": { "description": "Rating created" } }
      }
    },
    "/challenges": {
      "get": { "summary": "List weekly challenges", "tags": ["Challenges"], "responses": { "200": { "description": "OK" } } },
      "post": { "summary": "Create a weekly challenge (admin)", "tags": ["Challenges"], "security": [{ "bearerAuth": [] }], "responses": { "201": { "description": "Created" } } }
    }
  }
}
